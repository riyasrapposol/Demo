<!DOCTYPE html>
<!--
Copyright 2014 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<link rel="manifest" href="manifest.json">
<script>
var scope = 'hello/';
var registration;

function register() {
 /* navigator.serviceWorker.register('service-worker.js', {scope: scope})
    .then(function(r) {
      console.log('registered: ');
      registration = r;
      console.log(registration);
    })
    .catch(function(whut) {
      console.error('uh oh... ');
      console.error(whut);
    });*/
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
        .then(initialiseState);
        } else {
        console.warn('Service workers aren\'t supported in this browser.');
        }
}

function unregister() {
  registration.unregister()
    .then(function() {
      console.log('unregistered');
    });
}

// Once the service worker is registered set the initial state
function initialiseState() 
{
        // Are Notifications supported in the service worker?
        if (!('showNotification' in ServiceWorkerRegistration.prototype)) {
        console.warn('Notifications aren\'t supported.');
        return;
        }
        // Check the current Notification permission.
        // If its denied, it's a permanent block until the
        // user changes the permission
        if (Notification.permission === 'denied') {
        console.warn('The user has blocked notifications.');
        
        return;
            }
        // Check if push messaging is supported
        if (!('PushManager' in window)) {
        console.warn('Push messaging isn\'t supported.');
        return;
        }
        // We need the service worker registration to check for a subscription
        navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
        // Do we already have a push message subscription?
        serviceWorkerRegistration.pushManager.getSubscription()
        .then(function(subscription) {
        // Enable any UI which subscribes / unsubscribes from
        // push messages.
        var pushButton = document.querySelector('.js-push-button');
        pushButton.disabled = false;
        if (!subscription) {
        // We aren't subscribed to push, so set UI
        // to allow the user to enable push
        return;
        }
        // Keep your server in sync with the latest subscriptionId
        sendSubscriptionToServer(subscription);
        // Set your UI to show they have subscribed for
        // push messages
        pushButton.textContent = 'Disable Push Messages';
        isPushEnabled = true;
        })
        .catch(function(err) {
        console.warn('Error during getSubscription()', err);
        });
        });
    }
</script>
<button onclick="register()">Register</button>
<button onclick="unregister()">Unregister</button>

<p>Some nice places to visit:

<ul>
<li><a href="hello/world">world</a>
<li><a href="hello/Cleveland">Cleveland</a></li>
<li><button class="js-push-button" disabled>
Enable Push Messages
</button></li>
</ul>

