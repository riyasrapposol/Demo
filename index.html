<!doctype html>
<html>
<head>
  <title>Simple Push Demo</title>
  <link rel="manifest" href="manifest.json">
 </head>

<script>
var scope = 'hello/';
var registration;

function register() {
 /* navigator.serviceWorker.register('service-worker.js', {scope: scope})
    .then(function(r) {
      console.log('registered: ');
      registration = r;
      console.log(registration);
    })
    .catch(function(whut) {
      console.error('uh oh... ');
      console.error(whut);
    });*/
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js', {scope: scope})
        .then(initialiseState);
        } else {
        console.warn('Service workers aren\'t supported in this browser.');
        }
}

function unregister() {
  registration.unregister()
    .then(function() {
      console.log('unregistered');
    });
}

// Once the service worker is registered set the initial state
function initialiseState() 
{
      console.log('test1');
        // Are Notifications supported in the service worker?
        if (!('showNotification' in ServiceWorkerRegistration.prototype)) {
        console.log('Notifications aren\'t supported.');
        return;
        }
        console.log('test2');
        // Check the current Notification permission.
        // If its denied, it's a permanent block until the
        // user changes the permission
        if (Notification.permission === 'denied')
        {
          console.log('The user has blocked notifications.');
          return;
        }
        console.log('test3');
        // Check if push messaging is supported
        if (!('PushManager' in window))
        {
          console.warn('Push messaging isn\'t supported.');
          return;
        }
        console.log('test4');
        var r1 = navigator.serviceWorker.ready();
        console.log(r1);
        // We need the service worker registration to check for a subscription
        navigator.serviceWorker.ready.then(
                /*  function(serviceWorkerRegistration) 
                  {
                     console.log('test5');
                      // Do we already have a push message subscription?
                      serviceWorkerRegistration.pushManager.getSubscription()
                      .then(
                            function(subscription) 
                            {
                                                  // Enable any UI which subscribes / unsubscribes from
                                                  // push messages.
                                                  console.log('test6');
                                                  var pushButton = document.querySelector('.js-push-button');
                                                  pushButton.disabled = false;
                                                  if (!subscription) 
                                                  {
                                                    // We aren't subscribed to push, so set UI
                                                    // to allow the user to enable push
                                                    console.log('test4');
                                                    return;
                                                  }
                                                  console.log('test5');
                                                  // Keep your server in sync with the latest subscriptionId
                                                  sendSubscriptionToServer(subscription);
                                                  // Set your UI to show they have subscribed for
                                                  // push messages
                                                  pushButton.textContent = 'Disable Push Messages';
                                                  isPushEnabled = true;
                              }*/
                             function(r) {
      console.log('Serice Workder Ready: ');
      //registration = r;
      //console.log(registration);
    } )
        .catch(function(err) {
        console.warn('Error during getSubscription()', err);
        });
        });
    }
</script>
<body>
    
<button onclick="register()">Register</button>
<button onclick="unregister()">Unregister</button>

<p>Some nice places to visit:

<ul>
<li><a href="hello/world">world</a>
<li><a href="hello/Cleveland">Cleveland</a></li>
<li><button class="js-push-button" disabled>
Enable Push Messages
</button></li>
</ul>
</body></html>

